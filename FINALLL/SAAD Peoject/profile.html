<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Profile</title>
    <link rel="stylesheet" href="assets/style.css" />
  </head>
  <body>
    <div class="page">
      <main class="card">
        <h1>My Profile</h1>
        <p id="who" class="muted"></p>

        <h2>Account Information</h2>
        <div id="acctInfo" class="muted" style="margin: 12px 0"></div>

        <h2>Change Password</h2>
        <form id="pwForm" style="margin: 12px 0">
          <label
            >Current Password<input id="curPw" type="password" required
          /></label>
          <label
            >New Password<input id="newPw" type="password" required
          /></label>
          <div class="actions">
            <button type="submit">Update Password</button>
          </div>
        </form>
        <p id="pwMsg" class="muted"></p>
      </main>
    </div>

    <script src="assets/app.js"></script>
    <script>
      UMSApp.requireAuth();
      const user = UMSApp.currentUser();
      document.getElementById("who").textContent = `${user.username}`;
      document.getElementById(
        "acctInfo"
      ).innerHTML = `<div>Username: <strong>${user.username}</strong></div><div>Role: <strong>${user.role}</strong></div>`;

      document.getElementById("pwForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const cur = document.getElementById("curPw").value;
        const neu = document.getElementById("newPw").value;
        try {
          UMSApp.changePassword(user.username, cur, neu);
          document.getElementById("pwMsg").innerHTML =
            '<span class="success">Password updated successfully.</span>';
          document.getElementById("pwForm").reset();
        } catch (err) {
          document.getElementById(
            "pwMsg"
          ).innerHTML = `<span class="error">Error: ${err.message}</span>`;
        }
      });
    </script>
  </body>
</html>
