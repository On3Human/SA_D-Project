<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Grades</title>
    <link rel="stylesheet" href="assets/style.css" />
  </head>
  <body>
    <div class="page">
      <main class="card">
        <h1>Grades</h1>
        <p id="who" class="muted"></p>

        <div id="gradeArea" class="muted" style="margin-top: 12px"></div>
      </main>
    </div>

    <script src="assets/app.js"></script>
    <script>
      UMSApp.requireAuth();
      const user = UMSApp.currentUser();
      document.getElementById("who").textContent = `${user.role}`;
      const area = document.getElementById("gradeArea");

      if (user.role === "instructor") {
        const courses = UMSApp.data()
          .courses.map((c) => `<option value="${c.code}">${c.code}</option>`)
          .join("");
        area.innerHTML = `<form id="gForm" class="form-inline"><select id="gCourse">${courses}</select><input id="gStudent" placeholder="Student username"><input id="gValue" placeholder="Grade (e.g., A, B+, 85)"><button type="submit">Record Grade</button></form><div id="gList"></div>`;
        document.getElementById("gForm").addEventListener("submit", (e) => {
          e.preventDefault();
          UMSApp.saveGrade({
            student: document.getElementById("gStudent").value.trim(),
            course: document.getElementById("gCourse").value,
            grade: document.getElementById("gValue").value.trim(),
          });
          renderList();
        });
        function renderList() {
          document.getElementById("gList").innerHTML =
            "<h3>Recorded Grades</h3>" +
            (UMSApp.data()
              .grades.map(
                (g) =>
                  `<div>${g.student} in ${g.course}: <strong>${g.grade}</strong></div>`
              )
              .join("") || "<em>No grades recorded yet.</em>");
        }
        renderList();
      } else if (user.role === "student") {
        const my = UMSApp.data().grades.filter(
          (g) => g.student === user.username
        );
        area.innerHTML =
          "<h3>Your Grades</h3>" +
          (my
            .map((g) => `<div>${g.course}: <strong>${g.grade}</strong></div>`)
            .join("") || "<em>No grades available yet.</em>");
      } else {
        area.textContent = "Admins can view grades in the Admin Dashboard.";
      }
    </script>
  </body>
</html>
